/**
 * ASIN Monitoring Cleanup Helper
 * 
 * This script helps you identify which monitoring configs to keep/remove
 */

const API_BASE_URL = 'http://localhost:3001';

async function analyzeMonitoringConfigs() {
  console.log('üîç Analyzing Monitoring Configurations\n');

  try {
    const validateResponse = await fetch(`${API_BASE_URL}/api/asin-sku/validate`);
    const validateData = await validateResponse.json();

    if (!validateData.success) {
      console.error('‚ùå Failed to get validation data');
      return;
    }

    const mismatches = validateData.mismatches || [];

    // Categorize the ASINs
    const autoGenerated = mismatches.filter(m => m.currentSku.startsWith('AUTO-'));
    const customSkus = mismatches.filter(m => !m.currentSku.startsWith('AUTO-'));

    console.log('üìä Configuration Analysis:');
    console.log(`   ‚Ä¢ Total configurations: ${mismatches.length}`);
    console.log(`   ‚Ä¢ Auto-generated SKUs (AUTO-*): ${autoGenerated.length}`);
    console.log(`   ‚Ä¢ Custom/Manual SKUs: ${customSkus.length}`);

    console.log('\nü§ñ Auto-Generated SKUs (probably safe to remove):');
    autoGenerated.slice(0, 10).forEach((item, i) => {
      console.log(`   ${i + 1}. ${item.asin} ‚Üí ${item.currentSku}`);
    });
    if (autoGenerated.length > 10) {
      console.log(`   ... and ${autoGenerated.length - 10} more AUTO- entries`);
    }

    console.log('\nüë§ Custom/Manual SKUs (you might want to keep these):');
    customSkus.slice(0, 10).forEach((item, i) => {
      console.log(`   ${i + 1}. ${item.asin} ‚Üí ${item.currentSku}`);
    });
    if (customSkus.length > 10) {
      console.log(`   ... and ${customSkus.length - 10} more custom entries`);
    }

    console.log('\nüí° Recommendations:');
    console.log('1. KEEP configurations with meaningful SKUs like:');
    console.log('   - "Bundle - 203 Prime"');
    console.log('   - "MONINS27 - 003 Prime"');
    console.log('   - Other product-specific SKUs you recognize');

    console.log('\n2. CONSIDER REMOVING auto-generated SKUs like:');
    console.log('   - "AUTO-B07W5W7YCT"');
    console.log('   - "AUTO-B0CPKCVG66"');
    console.log('   - Other AUTO-* entries');

    console.log('\n3. OR import your Amazon listings data to fix all mappings automatically');

    console.log('\nüîß Next Steps:');
    console.log('   A) Import Amazon inventory ‚Üí amazon_listings table ‚Üí Run fix tool');
    console.log('   B) Manually clean up unwanted monitoring configs in Supabase');
    console.log('   C) Keep current setup if the custom SKUs are correct for your needs');

  } catch (error) {
    console.error('‚ùå Error analyzing configs:', error.message);
  }
}

analyzeMonitoringConfigs().catch(console.error);