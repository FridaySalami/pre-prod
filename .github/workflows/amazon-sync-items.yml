name: Sync Amazon Order Items

on:
  schedule:
    # Run every 5 minutes between 4:00 AM and 7:55 AM UTC
    # Since Amazon data often settles overnight, early morning is a good time.
    - cron: '*/5 4-7 * * *'
  
  # Allow manual triggering from the GitHub Actions tab for testing
  workflow_dispatch:

jobs:
  sync-items:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Sync Items Endpoint
        run: |
          # Use curl to hit the endpoint with the Bearer token
          # We use --fail to ensure the action fails if the server returns a 4xx/5xx error
          curl --request GET \
          --url "https://operations.chefstorecookbook.com/api/amazon/orders/sync-items?stream=false" \
          --header "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
          --header "Accept: application/json" \
          --fail \
          --verbose
